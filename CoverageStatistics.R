#Commands for Calculations for: Kruskal Wallis and Dunn's Test - Coverage
#Libraries ----
library(rstatix)
library(FSA)

#Coverage Statistics: ----
#Coverage Data - Median of Controls
#Protocol = P
data_BRCA2<-data.frame(
  Protocol = c(
    rep("P1", 10),
    rep("P2", 10),
    rep("P3", 10),
    rep("P4", 10),
    rep("P5", 10),
    rep("P6", 10),
    rep("P7", 2),
    rep("P8", 10)
  ),
  Coverage=c(
    41.98,65.75,70.33,47.86,68.99,77.94,57.31,70.34,53.27,76.94,
    27.23,28.22,11.54,13.05,25.97,39.17,38.49,26.37,9.43,11.56,
    16.46,28.46,26.24,14.61,40.03,20.98,89.34,39.14,44.56,54.91,
    24016.80,30919.10,17803.40,21585.40,20685.80,13299.50,19384.40,13024.00,26662.80,27946.40,
    6254.06,6240.18,6914.06,6531.28,6598.14,5960.34,6744.59,6934.77,7182.01,7358.05,
    1530.08,1165.17,1332.74,3221.22,1421.69,1174.82,1054.39,4584.47,13093.50,5583.94,
    145.27,124.23,
    37.37,44.60,57.41,67.90,31.60,57.04,112.61,84.68,59.28,84.81
  )
)

data_BRCA1<-data.frame(
  Protocol = c(
    rep("P1", 10),
    rep("P2", 10),
    rep("P3", 10),
    rep("P4", 10),
    rep("P5", 10),
    rep("P6", 10),
    rep("P7", 2),
    rep("P8", 10)
  ),
  Coverage=c(
    154.80,194.41,251.15,146.34,195.45,292.25,213.23,235.08,187.53,257.60,
    154.26,89.80,58.89,43.05,109.71,198.23,140.48,113.96,65.30,52.63,
    57.83,52.54,66.97,42.92,90.59,58.18,112.16,97.85,120.21,96.10,
    44526.10,196.04,835.30,27519.30,53445.30,44075.10,23005.40,667.49,37630.80,33398.10,
    4020.08,3308.39,3245.74,3870.37,3352.71,3861.98,3764.09,3882.39,4863.65,2940.89,
    3381.79,1752.89,3586.46,5670.82,3778.59,2662.45,1471.28,11009.80,16259.20,14112.80,
    443.11,426.59,
    53.15,79.17,57.39,101.22,34.87,59.49,114.15,88.80,62.41,83.51
  ) 
)

#Kruskal Wallis Test ----
# Perform Kruskal-Wallis test
kruskal_result_BRCA1 <- kruskal.test(Coverage ~ Protocol, data = data_BRCA1)

# Display results
print(kruskal_result_BRCA1)
#Result: Kruskal-Wallis chi-squared = 60.003, df = 7, p-value = 1.508e-10

kruskal_result_BRCA2 <- kruskal.test(Coverage ~ Protocol, data = data_BRCA2)

# Display results
print(kruskal_result_BRCA2)
#Result: Kruskal-Wallis chi-squared = 64.59, df = 7, p-value = 1.818e-11
#Conclusion: Need Dunn's Test for both BRCA1 and BRCA2

#Dunn's Test ----
dunn_BRCA1 <- dunnTest(Coverage ~ Protocol, data = data_BRCA1, method = "holm")
print(dunn_BRCA1)
#   Comparison           Z      P.unadj        P.adj
#1     P1 - P2  1.74154841 8.158750e-02 1.000000e+00
#2     P1 - P3  2.20097529 2.773777e-02 4.715421e-01
#3     P2 - P3  0.45942688 6.459276e-01 1.000000e+00
#4     P1 - P4 -2.70313956 6.868790e-03 1.305070e-01
#5     P2 - P4 -4.44468797 8.801952e-06 2.112469e-04
#6     P3 - P4 -4.90411485 9.384957e-07 2.533938e-05
#7     P1 - P5 -2.11550052 3.438731e-02 5.158097e-01
#8     P2 - P5 -3.85704893 1.147642e-04 2.295284e-03
#9     P3 - P5 -4.31647582 1.585400e-05 3.487881e-04
#10    P4 - P5  0.58763903 5.567746e-01 1.000000e+00
#11    P1 - P6 -2.17960660 2.928664e-02 4.685862e-01
#12    P2 - P6 -3.92115501 8.812555e-05 1.850637e-03
#13    P3 - P6 -4.38058189 1.183628e-05 2.722344e-04
#14    P4 - P6  0.52353296 6.006034e-01 1.000000e+00
#15    P5 - P6 -0.06410608 9.488858e-01 9.488858e-01
#16    P1 - P7 -0.43797132 6.614071e-01 1.000000e+00
#17    P2 - P7 -1.44345476 1.488924e-01 1.000000e+00
#18    P3 - P7 -1.70870499 8.750561e-02 1.000000e+00
#19    P4 - P7  1.12268704 2.615704e-01 1.000000e+00
#20    P5 - P7  0.78341348 4.333843e-01 1.000000e+00
#21    P6 - P7  0.82042514 4.119738e-01 1.000000e+00
#22    P1 - P8  2.36124048 1.821392e-02 3.278505e-01
#23    P2 - P8  0.61969207 5.354605e-01 1.000000e+00
#24    P3 - P8  0.16026519 8.726722e-01 1.000000e+00
#25    P4 - P8  5.06438004 4.097315e-07 1.147248e-05
#26    P5 - P8  4.47674101 7.579110e-06 1.894778e-04
#27    P6 - P8  4.54084708 5.602866e-06 1.456745e-04
#28    P7 - P8  1.80123414 7.166598e-02 1.000000e+00


dunn_BRCA2 <- dunnTest(Coverage ~ Protocol, data = data_BRCA2, method = "holm")
print(dunn_BRCA2)
#Comparison          Z      P.unadj        P.adj
#1     P1 - P2  2.2330283 2.554708e-02 4.598474e-01
#2     P1 - P3  1.4210180 1.553115e-01 1.000000e+00
#3     P2 - P3 -0.8120103 4.167857e-01 1.000000e+00
#4     P1 - P4 -4.0600515 4.906189e-05 1.079362e-03
#5     P2 - P4 -6.2930798 3.112282e-10 8.714388e-09
#6     P3 - P4 -5.4810695 4.227623e-08 1.141458e-06
#7     P1 - P5 -2.8954578 3.786059e-03 7.193513e-02
#8     P2 - P5 -5.1284861 2.920814e-07 7.594117e-06
#9     P3 - P5 -4.3164758 1.585400e-05 3.963501e-04
#10    P4 - P5  1.1645937 2.441835e-01 1.000000e+00
#11    P1 - P6 -2.0513944 4.022855e-02 6.034282e-01
#12    P2 - P6 -4.2844228 1.832142e-05 4.397141e-04
#13    P3 - P6 -3.4724125 5.158032e-04 1.083187e-02
#14    P4 - P6  2.0086571 4.457352e-02 5.794557e-01
#15    P5 - P6  0.8440633 3.986340e-01 1.000000e+00
#16    P1 - P7 -0.7464018 4.554247e-01 1.000000e+00
#17    P2 - P7 -2.0356413 4.178638e-02 5.850094e-01
#18    P3 - P7 -1.5668270 1.171551e-01 1.000000e+00
#19    P4 - P7  1.5976700 1.101164e-01 1.000000e+00
#20    P5 - P7  0.9252915 3.548143e-01 1.000000e+00
#21    P6 - P7  0.4379713 6.614071e-01 1.000000e+00
#22    P1 - P8  0.1495808 8.810953e-01 8.810953e-01
#23    P2 - P8 -2.0834475 3.721045e-02 5.953673e-01
#24    P3 - P8 -1.2714372 2.035732e-01 1.000000e+00
#25    P4 - P8  4.2096324 2.557866e-05 5.883091e-04
#26    P5 - P8  3.0450386 2.326504e-03 4.653008e-02
#27    P6 - P8  2.2009753 2.773777e-02 4.715421e-01
#28    P7 - P8  0.8327624 4.049788e-01 1.000000e+00

# BRCA1 significant differences
cat("=== BRCA1 SIGNIFICANT DIFFERENCES (P.adj < 0.05) ===\n")
brca1_significant <- dunn_BRCA1$res[dunn_BRCA1$res$P.adj < 0.05, ]
if(nrow(brca1_significant) > 0) {
  print(brca1_significant)
  cat("\nNumber of significant comparisons for BRCA1:", nrow(brca1_significant), "\n")
} else {
  cat("No significant differences found for BRCA1\n")
}

cat("\n")

# BRCA2 significant differences
cat("=== BRCA2 SIGNIFICANT DIFFERENCES (P.adj < 0.05) ===\n")
brca2_significant <- dunn_BRCA2$res[dunn_BRCA2$res$P.adj < 0.05, ]
if(nrow(brca2_significant) > 0) {
  print(brca2_significant)
  cat("\nNumber of significant comparisons for BRCA2:", nrow(brca2_significant), "\n")
} else {
  cat("No significant differences found for BRCA2\n")
}

# Combined
all_significant <- rbind(
  data.frame(Gene = "BRCA1", brca1_significant),
  data.frame(Gene = "BRCA2", brca2_significant)
)

cat("\n=== COMBINED SIGNIFICANT RESULTS ===\n")
print(all_significant)

#Result: Significant differences: 
# Gene Comparison         Z      P.unadj        P.adj
#5   BRCA1    P2 - P4 -4.444688 8.801952e-06 2.112469e-04
#6   BRCA1    P3 - P4 -4.904115 9.384957e-07 2.533938e-05
#8   BRCA1    P2 - P5 -3.857049 1.147642e-04 2.295284e-03
#9   BRCA1    P3 - P5 -4.316476 1.585400e-05 3.487881e-04
#12  BRCA1    P2 - P6 -3.921155 8.812555e-05 1.850637e-03
#13  BRCA1    P3 - P6 -4.380582 1.183628e-05 2.722344e-04
#25  BRCA1    P4 - P8  5.064380 4.097315e-07 1.147248e-05
#26  BRCA1    P5 - P8  4.476741 7.579110e-06 1.894778e-04
#27  BRCA1    P6 - P8  4.540847 5.602866e-06 1.456745e-04
#4   BRCA2    P1 - P4 -4.060052 4.906189e-05 1.079362e-03
#51  BRCA2    P2 - P4 -6.293080 3.112282e-10 8.714388e-09
#61  BRCA2    P3 - P4 -5.481070 4.227623e-08 1.141458e-06
#81  BRCA2    P2 - P5 -5.128486 2.920814e-07 7.594117e-06
#91  BRCA2    P3 - P5 -4.316476 1.585400e-05 3.963501e-04
#121 BRCA2    P2 - P6 -4.284423 1.832142e-05 4.397141e-04
#131 BRCA2    P3 - P6 -3.472412 5.158032e-04 1.083187e-02
#251 BRCA2    P4 - P8  4.209632 2.557866e-05 5.883091e-04
#261 BRCA2    P5 - P8  3.045039 2.326504e-03 4.653008e-02


